<div class="example-container mat-elevation-z8">
  <div class="example-loading-shade" *ngIf="isLoadingResults || isRateLimitReached">
    <mat-spinner *ngIf="isLoadingResults" [color]="'warn'"></mat-spinner>
    <div class="example-rate-limit-reached" *ngIf="isRateLimitReached">
      API rate limit has been reached.
    </div>
  </div>

  <div class="score-table-container">
    <form class="filters-form">
      <mat-form-field class="name-form-field">
        <mat-label class="search-label">Name filter</mat-label>

        <input matInput name="name" placeholder="Input name and press Enter" [(ngModel)]="nameFilter" type="text" minlength="4"
          (keyup.enter)="name.valid && nameFilterChanged()" #name="ngModel" class="search-input">

        <div *ngIf="name.invalid && (name.dirty || name.touched)" class="invalid-input">
          <div *ngIf="name.errors.minlength">
            Name must be at least 4 characters long.
          </div>
        </div>

      </mat-form-field>

      <mat-form-field class="country-form-field">
        <mat-label class="search-label">Country filter</mat-label>
        <input matInput type="text" placeholder="Ex. Germany" class="country-input" [formControl]="countryControl"
          [matAutocomplete]="auto">
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option *ngFor="let countryName of filteredCountryNames | async" [value]="countryName">
            {{ countryName }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

    </form>

    <table #table mat-table [dataSource]="data" id="score-table-id" class="score-table" matSort matSortActive="rating"
      matSortDirection="desc" matSortDisableClear multiTemplateDataRows>
      <!-- Rank Column -->
      <ng-container matColumnDef="rank">
        <th mat-header-cell *matHeaderCellDef>Rank</th>
        <td mat-cell *matCellDef="let row">
          {{row.rank == row.id ? row.rank : row.id + ' (' + row.rank + ')'}}
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let row" [ngStyle]="getScoreStyle(row.rating)">
          <a [routerLink]="['/athlete', row.profile]" class="invisible-link">
            <span [ngStyle]="getFirstLetterStyle(row.rating)">{{row.name.substr(0, 1)}}</span>{{row.name.substr(1)}}
          </a></td>
      </ng-container>

      <!-- Country Column -->
      <ng-container matColumnDef="country">
        <th mat-header-cell *matHeaderCellDef>Country</th>
        <td mat-cell *matCellDef="let row">{{getCountryFlag(row.country)}}{{row.country}}</td>
      </ng-container>

      <ng-container matColumnDef="group">
        <th mat-header-cell *matHeaderCellDef>Group</th>
        <td mat-cell *matCellDef="let row">{{row.group}}</td>
      </ng-container>

      <!-- Races Column -->
      <ng-container matColumnDef="races">
        <th mat-header-cell *matHeaderCellDef mat-sort-header matSortStart="asc" disableClear>Races</th>
        <!-- <th mat-header-cell *matHeaderCellDef>Races</th> -->
        <td mat-cell *matCellDef="let row">{{row.races}}</td>
      </ng-container>

      <!-- Rating Column -->
      <ng-container matColumnDef="rating">
        <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Rating</th>
        <td mat-cell *matCellDef="let row">{{row.rating}}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <mat-paginator [length]="resultsLength" [pageSizeOptions]="[20, 50, 100]" (page)="onPageEvent()"></mat-paginator>
</div>